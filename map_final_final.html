<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Olympic Hosting Map</title>
  <style>
  /* é¡µé¢èƒŒæ™¯ï¼šæ¸å˜åŠ¨ç”»èƒŒæ™¯ 
  body {
  background: linear-gradient(180deg, #E0F7FA, #B2EBF2, #E0F2F1);
  background-size: 400% 400%;
  animation: tealGradient 15s ease infinite;
}

@keyframes tealGradient {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
*/
/* å›½å®¶åŒºåŸŸçš„é»˜è®¤æ ·å¼ */
.country {
  stroke-width: 1.2px;
  transition: fill 0.3s ease, stroke 0.3s ease; /* å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */
}

/* å¢å¼º tooltip æ ·å¼ */
.tooltip {
  position: absolute;
  background: rgba(0, 0, 0, 0.8); /* æ”¹ä¸ºæ·±è‰²åŠé€æ˜èƒŒæ™¯ */
  padding: 12px;
  border: 1px solid #FFD700; /* æ”¹ä¸ºé‡‘è‰²è¾¹æ¡† */
  border-radius: 10px; /* åœ†è§’ */
  box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.4); /* åŠ å¼ºæŠ•å½±æ•ˆæœ */
  font-family: Arial, sans-serif;
  font-size: 12px;
  color: #fff; /* æ”¹ä¸ºç™½è‰²æ–‡å­—ï¼Œæ­é…æ·±è‰²èƒŒæ™¯ */
  display: none;
  pointer-events: none;
  z-index: 10;
  transition: all 0.3s ease; /* å¢åŠ æ·¡å…¥æ·¡å‡ºæ•ˆæœ */
}

/* tooltip æ ‡é¢˜æ ·å¼ */
.tooltip h3 {
  margin: 0;
  font-size: 16px;
  font-weight: bold;
  color: #FFD700; /* æ ‡é¢˜é‡‘è‰² */
}

/* tooltip æ•°æ®æ–‡å­—æ ·å¼ */
.tooltip p {
  margin: 5px 0 0;
  line-height: 1.5;
}

/* å®šä¹‰å›½å®¶åŒºåŸŸçš„æ‚¬åœæ•ˆæœï¼šæ”¾å¤§å’Œå‘å…‰ */
.country:hover {
  stroke: #DAA520; /* é‡‘è‰²è¾¹æ¡† */
  stroke-width: 2px;
  filter: drop-shadow(0px 0px 5px #DAA520); /* å‘å…‰æ•ˆæœ */
  transform: scale(1); /* æ”¾å¤§ */
  transition: transform 0.2s ease; /* å¹³æ»‘æ”¾å¤§åŠ¨ç”» */
}

/* è¾¹æ¡†é—ªçƒåŠ¨ç”» */
@keyframes glow {
  0%, 100% {
    stroke: #DAA520;
    stroke-width: 2;
  }
  50% {
    stroke: #333;
    stroke-width: 1;
  }
}

/* é—ªå…‰æ•ˆæœç±» */
.glow {
  animation: glow 1s infinite;
}

</style>
  
</head>
<body>
  <div id="map"></div>
  <div class="tooltip" id="tooltip"></div>

  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script>
    const width = 1400, height = 800;
    const colorScale = d3.scaleSequential(d3.interpolateBlues);

    // 1. åˆ›å»º SVG å®¹å™¨
    function createSVG() {
      const svg = d3.select("#map")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);
        // æ·»åŠ è¾¹æ¡†çŸ©å½¢
        svg.append("rect")
            .attr("x", 10) // å·¦è¾¹è·
            .attr("y", 10) // é¡¶è¾¹è·
            .attr("width", width - 20) // ä½¿è¾¹æ¡†ç•¥å°äº SVG å®½åº¦
            .attr("height", height - 20) // ä½¿è¾¹æ¡†ç•¥å°äº SVG é«˜åº¦
            .attr("stroke", "black") // è¾¹æ¡†é¢œè‰²
            .attr("stroke-width", 3) // è¾¹æ¡†å®½åº¦
            .attr("fill", "none"); // ç¡®ä¿æ²¡æœ‰å¡«å……è‰²    
        svg.append("text")
            .attr("x", width / 2)
            .attr("y", 80)
            .attr("text-anchor", "middle")
            .style("font-size", "32px") // åŠ å¤§å­—ä½“
            .style("font-weight", "bold")
            .style("fill", "black") // æ”¹å˜æ ‡é¢˜é¢œè‰²
            .style("font-family", "Arial, sans-serif")
            .style("text-transform", "uppercase") // å°†æ ‡é¢˜å¤§å†™
            .style("letter-spacing", "1.5px") // å¢åŠ å­—æ¯é—´è·
            .style("text-shadow", "2px 2px 4px rgba(0, 0, 0, 0.4)") // æ·»åŠ é˜´å½±æ•ˆæœ
            .text("Countries That Have Hosted the Olympic Games (1896â€“2024)");

        return svg;

    }

    // 2. å®šä¹‰æŠ•å½±å’Œè·¯å¾„ç”Ÿæˆå™¨
    function defineProjection() {
      const projection = d3.geoEquirectangular()
                           .scale(180)
                           .translate([width / 2, height / 2]);
      return d3.geoPath().projection(projection);
    }

    // 3. åŠ è½½æ•°æ®
    async function loadData() {
      const worldData = await d3.json("countries.geo.json");
      const hostingData = await d3.csv("olympic_hosts_by_country.csv");
      
      return { worldData, hostingData };
    }

    // 4. ç»˜åˆ¶åœ°å›¾
    function drawMap(svg, path, worldData, hostingData) {
      const maxHostingTimes = d3.max(hostingData, d => +d.Total);
      colorScale.domain([0, maxHostingTimes]);

      svg.selectAll("path")
         .data(worldData.features)
         .enter()
         .append("path")
         .attr("d", path)
         .attr("fill", d => {
           const countryData = hostingData.find(c => c.Country === d.properties.name);
           return countryData ? colorScale(+countryData.Total) : "#f7fbff";
         })
         .attr("stroke", "black")
         .attr("stroke-width", 2)
         .attr("class", "country");
    }

    // 5. æ·»åŠ å›¾ä¾‹
    function addLegend(svg, maxHostingTimes) {
      const legendWidth = 200;
      const legendHeight = 20;

      const legendScale = d3.scaleLinear()
                            .domain([0, maxHostingTimes])
                            .range([0, legendWidth]);

      const legend = svg.append("g")
                        .attr("class", "legend")
                        .attr("transform", `translate(${width - 250}, ${height - 100})`);

      // æ¸å˜è‰²æ¡
      legend.append("rect")
            .attr("width", legendWidth)
            .attr("height", legendHeight)
            .style("fill", "url(#gradient)");

      const defs = svg.append("defs");
      const linearGradient = defs.append("linearGradient")
                                 .attr("id", "gradient");

      linearGradient.selectAll("stop")
                    .data(colorScale.ticks().map((t, i, n) => ({
                      offset: `${100 * i / n.length}%`,
                      color: colorScale(t)
                    })))
                    .enter().append("stop")
                    .attr("offset", d => d.offset)
                    .attr("stop-color", d => d.color);

      legend.append("g")
            .attr("transform", `translate(0, ${legendHeight})`)
            .call(d3.axisBottom(legendScale).ticks(5).tickFormat(d3.format("d")))
            .selectAll("text") // é€‰æ‹©å›¾ä¾‹åˆ»åº¦æ–‡æœ¬
            .style("font-weight", "bold"); // è®¾ç½®åŠ ç²—
      // æ·»åŠ è¯´æ˜æ–‡å­—
      legend.append("text")
            .attr("x", legendWidth / 2)
            .attr("y", legendHeight + 30) // ä½ç½®åœ¨å›¾ä¾‹ä¸‹æ–¹
            .attr("text-anchor", "middle")
            .style("font-size", "12px")
            .style("font-weight", "bold")
            .text("Number of Olympic Games Hosted"); // è¯´æ˜æ–‡å­—å†…å®¹
    }
    // 6. æ·»åŠ æ‚¬åœæ•ˆæœ
    function addTooltipAndHoverEffects(svg, hostingData) {
      svg.selectAll(".country")
          .on("mouseover", function (event, d) {
            // æŸ¥æ‰¾å¯¹åº”çš„å›½å®¶æ•°æ®
            const countryData = hostingData.find(c => c.Country === d.properties.name);

            // æ˜¾ç¤º tooltip
            if (countryData) {
              d3.select("#tooltip")
                .style("display", "block")
                .html(`
                  <h3 style="font-weight: bold; color: #FFD700;">ğŸŒ ${countryData.Country}</h3> <!-- æ ‡é¢˜åŠ ç²—ï¼Œæ”¹å˜é¢œè‰² -->
                  <p><span style="font-weight: bold; color: #FFFFFF;">ğŸŒ Total Hosted Olympics:</span>
                     <span style="font-weight: bold; color: #FFFFFF;">${countryData.Total}</span></p>
                  <p><span style="font-weight: bold; color: #A52A2A;">ğŸ–ï¸ Summer Olympics:</span> 
                     <span style="font-weight: bold; color: #A52A2A;">${countryData["Summer Olympics"]}</span></p>
                  <p><span style="font-weight: bold; color: #4682B4;">â„ï¸ Winter Olympics:</span> 
                     <span style="font-weight: bold; color: #4682B4;">${countryData["Winter Olympics"]}</span></p>
                 `); 
               }else {
        // æ²¡æœ‰å¥¥è¿ä¼šæ•°æ®æ—¶ï¼Œä»…æ˜¾ç¤ºå›½å®¶åç§°
        d3.select("#tooltip")
          .style("display", "block")
          .html(`<h3>ğŸŒ${d.properties.name}</h3>`);
      }

      // çªå‡ºæ˜¾ç¤ºæ•ˆæœ
      d3.select(this)
        .style("transform-origin", "center")
        .transition()
        .duration(200)
        .style("transform", "scale(1.005)")
        .attr("stroke", "#DAA520")
        .attr("stroke-width", 2)
        .classed("glow", true); // æ·»åŠ  glow ç±»ä»¥å¯åŠ¨é—ªå…‰åŠ¨ç”»
    })
        .on("mousemove", event => {
          // è®¾ç½® tooltip çš„ä½ç½®ï¼Œé¿å…ç›´æ¥ä½äºé¼ æ ‡ä¸‹æ–¹
          const tooltipWidth = document.getElementById("tooltip").offsetWidth;
          const tooltipHeight = document.getElementById("tooltip").offsetHeight;
          
          d3.select("#tooltip")
            .style("left", (event.pageX + 15) + "px") // è®¾ç½® tooltip çš„ X åç§»é‡
            .style("top", (event.pageY - tooltipHeight - 15) + "px"); // è®¾ç½® tooltip çš„ Y åç§»é‡
        })
        .on("mouseout", function () {
          // éšè— tooltip
          d3.select("#tooltip").style("display", "none");

          // å–æ¶ˆçªå‡ºæ˜¾ç¤ºæ•ˆæœ
          d3.select(this)
            .transition()
            .duration(200)
            .style("transform", "scale(1)")
            .attr("stroke", "black")
            .attr("stroke-width", 0.5)
            .classed("glow", false); // ç§»é™¤ glow ç±»
        });
}

    // ä¸»ç¨‹åºï¼šè°ƒç”¨å„å‡½æ•°æ‰§è¡Œæ“ä½œ
    async function main() {
      const svg = createSVG();
      const path = defineProjection();
      const { worldData, hostingData } = await loadData();
      drawMap(svg, path, worldData, hostingData);
      addTooltipAndHoverEffects(svg, hostingData); 
      const maxHostingTimes = d3.max(hostingData, d => +d.Total);
      addLegend(svg, maxHostingTimes);
    }

    // å¯åŠ¨ç¨‹åº
    main();

  </script>
</body>
</html>
